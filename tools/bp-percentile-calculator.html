<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pediatric BP Percentile Calculator - AAP 2017</title>
    <style>
        :root {
            --primary: #2563eb;
            --success: #16a34a;
            --warning: #eab308;
            --danger: #dc2626;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --border: #e2e8f0;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 1rem;
        }
        .container { max-width: 600px; margin: 0 auto; }
        h1 {
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        .subtitle {
            text-align: center;
            color: #64748b;
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
        }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }
        .form-group { margin-bottom: 1rem; }
        label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }
        input, select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .row-3 { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 0.5rem; }
        button {
            width: 100%;
            padding: 0.875rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:hover { background: #1d4ed8; }
        .results { display: none; }
        .results.show { display: block; }
        .result-box {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }
        .result-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.8;
        }
        .result-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        .result-detail {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        .sbp-box { background: #dbeafe; color: #1e40af; }
        .dbp-box { background: #fef3c7; color: #92400e; }
        .classification {
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
        }
        .normal { background: #dcfce7; color: #166534; }
        .elevated { background: #fef9c3; color: #854d0e; }
        .stage1 { background: #fed7aa; color: #9a3412; }
        .stage2 { background: #fecaca; color: #991b1b; }

        /* Visual Gauge */
        .gauge-section {
            margin: 1rem 0;
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 8px;
        }
        .gauge-row {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .gauge-label {
            width: 40px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #64748b;
        }
        .gauge-bar {
            flex: 1;
            height: 10px;
            background: linear-gradient(90deg,
                #22c55e 0%, #22c55e 80%,
                #eab308 80%, #eab308 90%,
                #f97316 90%, #f97316 95%,
                #dc2626 95%, #dc2626 100%);
            border-radius: 5px;
            position: relative;
        }
        .gauge-marker {
            position: absolute;
            top: -3px;
            width: 4px;
            height: 16px;
            background: #1e293b;
            border-radius: 2px;
            transform: translateX(-50%);
            transition: left 0.5s ease-out;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        .gauge-legend {
            display: flex;
            justify-content: space-between;
            margin-left: 40px;
            font-size: 0.65rem;
            color: #94a3b8;
            margin-top: 0.25rem;
        }

        .thresholds {
            margin-top: 1rem;
            padding: 1rem;
            background: #f1f5f9;
            border-radius: 8px;
            font-size: 0.875rem;
        }
        .thresholds h4 { margin-bottom: 0.5rem; font-size: 0.875rem; }
        .threshold-row {
            display: flex;
            justify-content: space-between;
            padding: 0.25rem 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .threshold-row:last-child { border-bottom: none; }
        .error {
            color: var(--danger);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        .warning {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            color: #92400e;
            padding: 0.75rem;
            border-radius: 8px;
            margin-top: 0.75rem;
            font-size: 0.875rem;
        }
        .warning-icon { margin-right: 0.5rem; }
        .info-box {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            color: #1e40af;
            padding: 0.75rem;
            border-radius: 8px;
            margin-top: 0.75rem;
            font-size: 0.8rem;
        }
        .credits {
            text-align: center;
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 1rem;
        }
        .credits a { color: var(--primary); }
        .disclaimer {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            color: #64748b;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.75rem;
            margin-top: 1rem;
            text-align: center;
        }
        .validation-details {
            display: inline;
        }
        .validation-details summary {
            cursor: pointer;
            color: var(--primary);
            list-style: none;
            display: inline;
        }
        .validation-details summary::-webkit-details-marker { display: none; }
        .validation-details[open] summary { display: block; margin-bottom: 0.5rem; }
        .validation-content {
            text-align: left;
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 0.75rem;
            margin-top: 0.5rem;
            color: #475569;
        }
        .validation-content ul {
            margin: 0.25rem 0 0.5rem 1rem;
            padding: 0;
        }
        .validation-content li {
            margin-bottom: 0.25rem;
        }
        .height-zscore {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 0.25rem;
        }
        .precision-note {
            font-size: 0.7rem;
            color: #94a3b8;
            font-style: italic;
        }
        .age-display {
            font-size: 0.9rem;
            color: var(--primary);
            font-weight: 600;
            margin-top: 0.5rem;
            min-height: 1.4em;
        }
        .sex-toggle {
            display: flex;
            background: #e2e8f0;
            border-radius: 8px;
            padding: 4px;
        }
        .sex-btn {
            flex: 1;
            padding: 0.6rem 1rem;
            border: none;
            background: transparent;
            font-size: 0.95rem;
            font-weight: 500;
            color: #64748b;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }
        .sex-btn.active {
            background: #fff;
            color: var(--primary);
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .toggle-precision {
            font-size: 0.75rem;
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            margin-left: 0.5rem;
        }
        .age-input-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .age-input-row input { flex: 1; }
        .age-input-row select { width: auto; min-width: 100px; }
        #ageMonths { width: 80px; }
        
        /* Instructions panel */
        .instructions-panel {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 12px;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }
        .instructions-panel summary {
            padding: 0.75rem 1rem;
            cursor: pointer;
            font-weight: 600;
            color: #0369a1;
            list-style: none;
        }
        .instructions-panel summary::-webkit-details-marker { display: none; }
        .instructions-panel summary::before { content: "‚ñ∂ "; font-size: 0.7rem; }
        .instructions-panel[open] summary::before { content: "‚ñº "; }
        .instructions-content {
            padding: 0 1rem 1rem 1rem;
            color: #0c4a6e;
        }
        .instructions-content h4 {
            margin: 0.75rem 0 0.5rem 0;
            font-size: 0.875rem;
            color: #0369a1;
        }
        .instructions-content ol, .instructions-content ul {
            margin: 0;
            padding-left: 1.25rem;
        }
        .instructions-content li {
            margin-bottom: 0.35rem;
            line-height: 1.4;
        }
        .instructions-content em {
            background: #e0f2fe;
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
            font-style: normal;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Pediatric BP Percentile Calculator</h1>
        <p class="subtitle">AAP 2017 Clinical Practice Guidelines</p>
        
        <details class="instructions-panel">
            <summary>üìã How to Use This Calculator</summary>
            <div class="instructions-content">
                <h4>For Best Accuracy:</h4>
                <ol>
                    <li><strong>Age:</strong> Enter the child's exact age using <em>Years + Months</em> (e.g., 8 years, 4 months). This matches how percentiles are calculated in the AAP reference tables.</li>
                    <li><strong>Height:</strong> Measure height accurately ‚Äî small errors affect percentile calculations. The calculator will show a height z-score to help identify measurement errors.</li>
                    <li><strong>BP Measurement:</strong> Use the average of 2-3 auscultatory readings taken after 5 minutes of rest, per AAP guidelines.</li>
                </ol>
                
                <h4>Understanding Results:</h4>
                <ul>
                    <li><strong>Accuracy:</strong> Results are within ¬±1 percentile of published AAP tables</li>
                    <li><strong>For ages ‚â•13:</strong> Classification uses absolute thresholds (120/130/140 mmHg) per adult guidelines</li>
                    <li><strong>For ages &lt;13:</strong> Classification uses both percentiles AND absolute thresholds, whichever is lower</li>
                </ul>
                
                <h4>When to Be Cautious:</h4>
                <ul>
                    <li>‚ö†Ô∏è Height z-score &gt; 3 or &lt; -3 may indicate measurement error</li>
                    <li>‚ö†Ô∏è Ages &lt;5 or &gt;17 years are outside the validated range</li>
                    <li>‚ö†Ô∏è Single readings should not be used to diagnose hypertension</li>
                </ul>
            </div>
        </details>
        
        <div class="card">
            <div class="row">
                <div class="form-group">
                    <label>Date of Birth</label>
                    <input type="date" id="dob" required>
                </div>
                <div class="form-group">
                    <label>Measurement Date</label>
                    <input type="date" id="measureDate">
                </div>
            </div>
            <div class="age-display" id="ageDisplay"></div>

            <div class="form-group">
                <label>Sex</label>
                <div class="sex-toggle" id="sexToggle">
                    <button type="button" class="sex-btn active" data-value="M">Male</button>
                    <button type="button" class="sex-btn" data-value="F">Female</button>
                </div>
                <input type="hidden" id="sex" value="M">
            </div>

            <div class="row">
                <div class="form-group">
                    <label>Height</label>
                    <input type="number" id="height" step="0.1" inputmode="decimal" placeholder="Enter height">
                    <div class="height-zscore" id="heightZscore"></div>
                </div>
                <div class="form-group">
                    <label>Unit</label>
                    <select id="heightUnit">
                        <option value="cm">cm</option>
                        <option value="in">in</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="form-group">
                    <label>Systolic BP (mmHg)</label>
                    <input type="number" id="sbp" min="50" max="250" placeholder="Systolic">
                </div>
                <div class="form-group">
                    <label>Diastolic BP (mmHg)</label>
                    <input type="number" id="dbp" min="30" max="150" placeholder="Diastolic">
                </div>
            </div>
            <button onclick="calculate()">Calculate Percentiles</button>
            <div id="error" class="error"></div>
            <div id="warnings"></div>
        </div>
        
        <div id="results" class="results">
            <div class="card">
                <div class="row">
                    <div class="result-box sbp-box">
                        <div class="result-label">Systolic BP</div>
                        <div class="result-value" id="sbpPct">--</div>
                        <div class="result-detail" id="sbpDetail"></div>
                    </div>
                    <div class="result-box dbp-box">
                        <div class="result-label">Diastolic BP</div>
                        <div class="result-value" id="dbpPct">--</div>
                        <div class="result-detail" id="dbpDetail"></div>
                    </div>
                </div>

                <div class="gauge-section">
                    <div class="gauge-row">
                        <span class="gauge-label">SBP</span>
                        <div class="gauge-bar">
                            <div class="gauge-marker" id="sbpMarker"></div>
                        </div>
                    </div>
                    <div class="gauge-row">
                        <span class="gauge-label">DBP</span>
                        <div class="gauge-bar">
                            <div class="gauge-marker" id="dbpMarker"></div>
                        </div>
                    </div>
                    <div class="gauge-legend">
                        <span>50th</span><span>90th</span><span>95th</span><span>99th</span>
                    </div>
                </div>

                <div id="classification" class="classification"></div>
                <div class="thresholds">
                    <h4>BP Thresholds for this patient:</h4>
                    <div class="threshold-row"><span>90th percentile:</span><span id="p90"></span></div>
                    <div class="threshold-row"><span>95th percentile:</span><span id="p95"></span></div>
                    <div class="threshold-row"><span>95th + 12 mmHg:</span><span id="p95plus12"></span></div>
                </div>
                <div class="info-box" id="calcDetails"></div>
            </div>
        </div>
        
        <div class="disclaimer">
            <strong>For educational purposes only.</strong> Not a substitute for professional medical judgment. 
            <details class="validation-details">
                <summary>Accuracy: ¬±1 percentile ‚ñ∏</summary>
                <div class="validation-content">
                    <strong>Validation performed against:</strong>
                    <ul>
                        <li><strong>AAP 2017 Table 4</strong> ‚Äî 24 test points, all within ¬±1 mmHg</li>
                        <li><strong>Rosner sample data</strong> ‚Äî 87.5% exact match, 100% within ¬±1 percentile</li>
                        <li><strong>bsolomon.us calculator</strong> ‚Äî BP values match to &lt;0.01 mmHg</li>
                    </ul>
                    <strong>Sources of ¬±1 variation:</strong> floating-point rounding, integer percentile discretization
                </div>
            </details>
        </div>
        
        <div class="credits">
            Flynn JT et al. <em>Pediatrics</em> 2017;140(3):e20171904 &bull; 
            Rosner B et al. <em>Am J Epidemiol</em> 2008;167(6):653-66
        </div>
    </div>
    
    <script>
// =============================================================================
// PEDIATRIC BP PERCENTILE CALCULATOR - AAP 2017
// Version 2.0 with premortem fixes
// =============================================================================

// CDC LMS parameters for height-for-age (ages 2-20 years)
// Source: CDC Growth Charts, 2000
// Format: age_months: [L, M, S]
const CDC_HEIGHT_LMS = {
    M: {
        24: [-0.1058, 86.4513, 0.03711], 36: [-0.0574, 95.0265, 0.03856], 48: [0.0017, 102.4931, 0.03928],
        60: [0.0694, 109.1782, 0.03972], 72: [0.1373, 115.4153, 0.04011], 84: [0.1916, 121.4265, 0.04058],
        96: [0.2256, 127.2841, 0.04117], 108: [0.2398, 132.9084, 0.04188], 120: [0.2389, 138.2109, 0.04266],
        132: [0.2296, 143.3419, 0.04349], 144: [0.2174, 149.0575, 0.04428], 156: [0.2049, 155.5361, 0.04489],
        168: [0.1928, 162.1742, 0.04516], 180: [0.1807, 167.8238, 0.04494], 192: [0.1686, 172.0466, 0.04426],
        204: [0.1565, 174.7165, 0.04330], 216: [0.1444, 176.1158, 0.04230], 228: [0.1323, 176.7862, 0.04145],
        240: [0.1202, 176.9843, 0.04086]
    },
    F: {
        24: [0.1139, 85.7153, 0.03879], 36: [0.2204, 94.1248, 0.04043], 48: [0.3275, 101.5981, 0.04141],
        60: [0.4275, 108.4122, 0.04215], 72: [0.5059, 114.7015, 0.04287], 84: [0.5521, 120.6386, 0.04369],
        96: [0.5632, 126.3574, 0.04468], 108: [0.5444, 131.8942, 0.04586], 120: [0.5032, 137.3971, 0.04721],
        132: [0.4466, 143.2552, 0.04859], 144: [0.3793, 149.5424, 0.04970], 156: [0.3047, 155.4755, 0.05023],
        168: [0.2265, 159.8245, 0.04996], 180: [0.1505, 162.3640, 0.04909], 192: [0.0835, 163.6686, 0.04803],
        204: [0.0320, 164.2264, 0.04712], 216: [0.0000, 164.3777, 0.04654], 228: [-0.0114, 164.3775, 0.04625],
        240: [-0.0114, 164.3375, 0.04613]
    }
};

// Coefficient arrays from BenSolomon/pediatric-bp (originally from Rosner lab)
// Array order per row: [b0, b1, b2, b3, b4, ba1, ba2, ba3, ba4, bb1, bb2, bb3, bb4]
const SBP_M = [[-15.1614,0.7016,-0.0159,0.0803,-0.1501,0.1585,0.7927,-16.2445,64.9588,0.0109,0.1002,-0.1603,0.0565],[7.1181,0.5512,-0.0095,0.054,-0.1228,0.1808,0.1658,-8.1838,41.4072,0.0057,0.0042,0.0299,-0.0661],[16.6833,0.5,-0.0072,0.037,-0.0808,-0.0164,0.2766,-6.0204,29.5897,-0.0092,0.0673,-0.0993,0.0246],[4.2312,0.583,-0.0104,0.0473,-0.0885,0.3344,0.0389,-4.8857,26.2991,0.0009,0.0958,-0.155,0.0586],[7.5365,0.5865,-0.0109,0.0523,-0.0938,-0.0042,0.4065,-5.8405,25.1459,0.001,0.0934,-0.1598,0.0738],[9.1488,0.6019,-0.0121,0.0661,-0.1243,-0.3319,0.8441,-9.4288,35.3411,-0.0028,0.105,-0.187,0.0975],[8.942,0.5921,-0.0126,0.0712,-0.1373,-0.0756,0.7374,-10.0163,38.7888,0.013,0.076,-0.1417,0.0814],[7.6195,0.5961,-0.0127,0.0706,-0.1365,0.0671,0.6085,-8.8982,34.0775,0.0147,0.0961,-0.1812,0.1062],[4.7191,0.6241,-0.014,0.074,-0.1321,0.0248,0.8039,-10.5118,37.6146,0.0285,0.0747,-0.1503,0.0994],[-3.7807,0.6754,-0.0144,0.0649,-0.1065,0.2569,0.5926,-10.5763,40.4022,0.0265,0.1273,-0.2395,0.1377],[-4.3588,0.6643,-0.0141,0.0598,-0.0914,0.5128,0.4441,-11.0057,43.9366,0.0297,0.1526,-0.2899,0.1703],[0.9793,0.6426,-0.0127,0.0539,-0.0858,0.277,0.5168,-10.2491,40.6962,0.0133,0.1639,-0.2987,0.1604],[4.1744,0.6197,-0.0121,0.0528,-0.0869,0.2919,0.5211,-10.2719,41.0334,0.0122,0.1661,-0.3033,0.1633],[6.8468,0.6088,-0.0115,0.0517,-0.0889,0.1938,0.5369,-9.8873,39.859,0.0046,0.1768,-0.321,0.1715],[11.1461,0.5761,-0.01,0.044,-0.0795,0.2378,0.3678,-8.151,35.8557,-0.0007,0.1778,-0.321,0.1698],[12.4221,0.5662,-0.0092,0.0391,-0.073,0.276,0.2488,-6.8316,31.9031,-0.0089,0.2003,-0.3583,0.1859],[10.6386,0.5675,-0.0093,0.0395,-0.0789,0.5028,0.0451,-6.0581,30.8189,-0.0048,0.1885,-0.3309,0.1625],[11.895,0.5654,-0.0088,0.0351,-0.0686,0.4259,0.0403,-5.1913,27.4155,-0.0151,0.216,-0.3783,0.1854],[15.6199,0.5485,-0.0083,0.0349,-0.0709,0.2947,0.1255,-4.8706,25.2474,-0.0153,0.1958,-0.3402,0.1631],[19.1961,0.5297,-0.0074,0.031,-0.0656,0.2043,0.1214,-4.058,22.8341,-0.025,0.2093,-0.3615,0.171],[24.9014,0.4951,-0.0063,0.0283,-0.0649,0.1164,0.1324,-3.0351,18.7307,-0.0265,0.1862,-0.3184,0.1463],[27.7411,0.4835,-0.0062,0.0313,-0.073,-0.0002,0.251,-3.251,17.9354,-0.026,0.1667,-0.2835,0.1289],[26.5408,0.4961,-0.0068,0.0361,-0.0837,-0.0132,0.3133,-3.6487,17.7499,-0.0188,0.1384,-0.2306,0.0976],[24.9608,0.5066,-0.0077,0.043,-0.0991,0.0679,0.2933,-3.7963,17.8167,-0.0102,0.1136,-0.1873,0.0762],[30.7628,0.4711,-0.0065,0.0402,-0.0991,-0.0404,0.3473,-3.514,16.9902,-0.0135,0.1043,-0.172,0.0705],[32.9166,0.4584,-0.0062,0.0397,-0.0994,-0.0712,0.3957,-3.9,17.9467,-0.0111,0.0905,-0.1473,0.0576],[35.8384,0.4447,-0.0061,0.0445,-0.1155,-0.154,0.4647,-4.0996,18.2022,-0.0116,0.0725,-0.1148,0.0406],[35.8936,0.4551,-0.0069,0.0522,-0.1317,-0.2601,0.5885,-4.4079,17.6393,-0.0062,0.042,-0.0594,0.0107],[35.6599,0.4616,-0.0074,0.0559,-0.1397,-0.2948,0.6396,-4.5403,17.3049,-0.0065,0.0482,-0.0732,0.0217],[34.2326,0.4801,-0.0079,0.0573,-0.1393,-0.3816,0.7322,-4.795,17.0262,-0.0049,0.0527,-0.0851,0.0332],[38.436,0.4592,-0.0074,0.0594,-0.1493,-0.518,0.8471,-5.2375,18.6249,-0.0109,0.0578,-0.0961,0.042],[37.4759,0.4543,-0.0072,0.0558,-0.1401,-0.3108,0.6669,-4.487,17.3228,-0.0071,0.0668,-0.1148,0.0546],[38.2626,0.4471,-0.0072,0.0565,-0.1436,-0.2565,0.595,-3.8813,15.733,-0.0047,0.058,-0.0993,0.0468],[40.1654,0.4421,-0.0071,0.0576,-0.1469,-0.373,0.7286,-4.669,17.4341,-0.0005,0.0365,-0.0612,0.0272],[42.9794,0.4348,-0.0069,0.0595,-0.1514,-0.5548,0.8878,-5.2907,18.8227,-0.0022,0.033,-0.0585,0.0309],[45.6449,0.4196,-0.0061,0.0555,-0.1462,-0.6118,0.8823,-5.0487,18.8985,-0.0051,0.0381,-0.069,0.0387],[46.6551,0.41,-0.0059,0.0537,-0.1435,-0.5689,0.866,-5.0611,19.3856,-0.0027,0.039,-0.0728,0.0431],[47.5003,0.4057,-0.0059,0.0563,-0.1527,-0.5697,0.8793,-5.203,19.8144,-0.0019,0.0291,-0.0538,0.0314],[45.403,0.4195,-0.0064,0.0585,-0.1569,-0.5065,0.8608,-5.5153,21.0092,0.0032,0.0197,-0.0361,0.0204],[44.8971,0.4168,-0.0064,0.0554,-0.147,-0.395,0.8017,-5.6222,21.9379,0.0027,0.0376,-0.069,0.0382],[47.5247,0.3999,-0.0058,0.0527,-0.1421,-0.4291,0.8436,-5.8317,22.6883,0.0015,0.0382,-0.0702,0.0389],[46.463,0.4049,-0.006,0.0518,-0.1372,-0.3679,0.8717,-6.4206,23.9766,0.0093,0.0233,-0.0445,0.0258],[43.9842,0.4126,-0.0063,0.0508,-0.1325,-0.1919,0.792,-6.7209,25.4109,0.0119,0.037,-0.0693,0.0383],[43.2939,0.4253,-0.0066,0.052,-0.1346,-0.2722,0.8627,-7.0319,25.6372,0.0151,0.022,-0.0414,0.0222],[44.9267,0.4173,-0.0066,0.054,-0.1396,-0.3058,0.9029,-7.1291,25.4723,0.0166,0.008,-0.0161,0.0087],[45.3659,0.4047,-0.006,0.0477,-0.1258,-0.1577,0.7596,-6.3854,23.8924,0.015,0.0245,-0.0444,0.0212],[45.5821,0.3963,-0.0056,0.046,-0.1251,-0.0245,0.5923,-5.4731,22.294,0.0164,0.0239,-0.0431,0.0201],[47.1433,0.3877,-0.0053,0.0449,-0.1222,-0.0461,0.591,-5.2852,21.7529,0.0153,0.0223,-0.0412,0.0208],[51.495,0.3619,-0.0042,0.0417,-0.1223,-0.1432,0.644,-5.3385,21.775,0.0089,0.0218,-0.0369,0.0143],[49.2507,0.3735,-0.0044,0.0403,-0.1176,-0.0452,0.5634,-5.0092,21.3118,0.0104,0.0345,-0.0607,0.0278],[48.723,0.3773,-0.0046,0.0403,-0.114,-0.0088,0.5464,-5.0086,21.4246,0.0144,0.0211,-0.0365,0.0147],[46.2919,0.387,-0.0047,0.0368,-0.1041,0.137,0.4328,-4.7097,21.0581,0.0171,0.0335,-0.0595,0.027],[47.5969,0.3772,-0.0039,0.0315,-0.0941,0.1489,0.3829,-4.2807,20.076,0.0134,0.0397,-0.0681,0.0283],[48.5103,0.3741,-0.0039,0.0318,-0.0943,0.1248,0.3886,-4.0219,19.1219,0.0115,0.0417,-0.0714,0.03],[47.0617,0.3815,-0.0041,0.0313,-0.0915,0.2003,0.3427,-3.9935,19.2648,0.0121,0.0505,-0.0878,0.0394],[47.9002,0.3802,-0.0041,0.032,-0.0944,0.1572,0.3732,-3.8154,17.8605,0.0113,0.0408,-0.067,0.024],[49.115,0.3783,-0.0042,0.0339,-0.0974,0.0782,0.4887,-4.5668,19.8764,0.0137,0.0304,-0.0508,0.019],[49.9451,0.3716,-0.0039,0.0318,-0.0942,0.1037,0.4323,-3.9989,18.2108,0.0126,0.0354,-0.0602,0.0246],[50.1287,0.3664,-0.0039,0.0327,-0.0981,0.2012,0.3324,-3.2058,15.608,0.0177,0.0133,-0.0189,0.0001],[49.51,0.3729,-0.0042,0.0344,-0.1008,0.1993,0.3903,-3.8043,17.1157,0.0221,0.0041,-0.0038,-0.0061],[47.0301,0.3864,-0.0047,0.0328,-0.0906,0.2961,0.3665,-3.9702,17.4284,0.0207,0.0246,-0.0408,0.0138],[46.9571,0.3932,-0.0048,0.0332,-0.0914,0.2268,0.4324,-4.3249,18.4933,0.0225,0.0162,-0.0255,0.0051],[45.7187,0.3986,-0.0048,0.0327,-0.0905,0.319,0.3143,-3.5355,16.3535,0.0195,0.039,-0.0672,0.0285],[46.6338,0.3928,-0.0047,0.0327,-0.0892,0.3294,0.3122,-3.6994,16.9404,0.02,0.0422,-0.0754,0.036],[46.796,0.4005,-0.0048,0.0316,-0.0843,0.2184,0.4173,-4.2913,18.3125,0.0138,0.0632,-0.1146,0.0591],[45.6059,0.409,-0.005,0.0313,-0.0814,0.2609,0.3536,-3.7119,16.4744,0.0161,0.0671,-0.1239,0.0669],[46.2843,0.4103,-0.005,0.0321,-0.0828,0.1969,0.384,-3.6001,15.9912,0.0153,0.0735,-0.139,0.08],[42.7066,0.4304,-0.0057,0.0333,-0.0798,0.3391,0.2772,-3.5789,16.5957,0.0158,0.0981,-0.1852,0.1067],[42.8015,0.4348,-0.0061,0.0357,-0.0812,0.3061,0.3293,-3.7417,16.4765,0.0203,0.0909,-0.1775,0.1098],[44.6588,0.4196,-0.0059,0.0374,-0.0881,0.3589,0.2756,-3.1211,14.5181,0.0175,0.0943,-0.1832,0.1126],[45.4978,0.4238,-0.0058,0.0377,-0.09,0.2369,0.3198,-2.8753,12.9699,0.0126,0.0997,-0.1911,0.1148],[44.3791,0.4342,-0.0061,0.0387,-0.0918,0.247,0.2747,-2.2776,10.7861,0.0106,0.1113,-0.2121,0.1265],[44.5213,0.4295,-0.006,0.0393,-0.0953,0.3308,0.2335,-2.5761,12.6357,0.015,0.1005,-0.192,0.1141],[43.3339,0.4397,-0.0064,0.0411,-0.0987,0.3496,0.2289,-2.6952,12.6151,0.0118,0.1138,-0.2135,0.1223],[45.7745,0.4279,-0.0062,0.0429,-0.1061,0.2806,0.323,-3.0124,12.5836,0.0132,0.0996,-0.1888,0.1104],[46.2858,0.4274,-0.0059,0.0399,-0.1008,0.2501,0.3239,-2.6897,11.1237,0.0086,0.1214,-0.2293,0.1336],[47.1461,0.4368,-0.0058,0.0399,-0.1016,0.0565,0.3804,-1.9028,7.5777,-0.0042,0.1495,-0.2777,0.1579],[49.8411,0.4224,-0.0051,0.0374,-0.0989,-0.0213,0.4353,-2.2574,9.0572,-0.0067,0.1499,-0.2787,0.1591],[54.41,0.4065,-0.0045,0.0392,-0.1059,-0.2754,0.6713,-3.3139,10.8614,-0.0134,0.1536,-0.2881,0.1687],[59.0571,0.3792,-0.0031,0.0313,-0.0925,-0.3916,0.714,-3.2563,11.6335,-0.0235,0.1848,-0.3462,0.2023],[61.5501,0.3688,-0.0028,0.0301,-0.0892,-0.4923,0.8257,-3.7049,12.2735,-0.0258,0.1974,-0.3735,0.2231],[62.0991,0.371,-0.0025,0.0277,-0.085,-0.5602,0.8523,-3.3702,9.855,-0.0253,0.1895,-0.3572,0.2113],[63.7402,0.3743,-0.0026,0.0296,-0.0853,-0.7486,1.0333,-4.0639,10.5288,-0.0264,0.1907,-0.3647,0.2234],[63.1912,0.3825,-0.0028,0.0301,-0.0846,-0.7684,1.0572,-4.1343,10.1666,-0.0226,0.1752,-0.3347,0.204],[65.29,0.3789,-0.0031,0.0353,-0.0982,-0.9003,1.2109,-4.7056,10.0344,-0.0171,0.1415,-0.2745,0.173],[69.7586,0.3466,-0.0015,0.0272,-0.0852,-0.9059,1.1421,-3.8514,8.3464,-0.0254,0.1633,-0.3147,0.1963],[68.7204,0.347,-0.0023,0.0323,-0.0945,-0.7413,1.161,-4.8929,11.4709,-0.0166,0.1384,-0.2677,0.1676],[70.0709,0.3366,-0.0017,0.0271,-0.0857,-0.7105,1.1845,-4.9763,11.0263,-0.0132,0.1197,-0.2317,0.1451],[71.2247,0.3239,-0.0008,0.022,-0.0796,-0.6095,1.0475,-4.2244,9.2028,-0.0212,0.1383,-0.2581,0.1496],[71.0728,0.3275,-0.0005,0.0181,-0.0707,-0.5897,0.954,-3.2255,5.828,-0.02,0.1457,-0.2721,0.1573],[70.0217,0.3265,-0.0006,0.0201,-0.0785,-0.3531,0.6571,-1.1748,0.806,-0.0091,0.1053,-0.1976,0.115],[70.5203,0.3319,-0.0017,0.0287,-0.092,-0.3866,0.7711,-1.2734,-1.0004,0.009,0.0424,-0.0915,0.0678],[76.3547,0.314,-0.0002,0.0247,-0.0938,-0.7212,0.9341,-1.3303,-1.6526,-0.0122,0.0896,-0.174,0.1101],[90.6025,0.2521,0.0034,0.0132,-0.0881,-1.3557,1.1746,0.1551,-7.729,-0.0357,0.0885,-0.1674,0.1033],[102.6662,0.1576,0.0072,-0.0076,-0.0516,-1.2263,0.8589,3.2534,-15.7885,-0.0325,0.0706,-0.1432,0.1009],[102.9154,0.1871,0.0055,0.002,-0.0596,-1.5899,1.4523,-0.5061,-7.5933,-0.0411,0.1113,-0.2264,0.1604],[125.2207,0.1438,0.0076,0.0111,-0.0959,-3.3398,2.9466,-5.4863,-1.908,-0.1006,0.1222,-0.2249,0.1376],[125.8697,0.1505,0.0067,0.0193,-0.1148,-3.2997,3.1051,-7.3155,3.4281,-0.0879,0.0819,-0.1569,0.1076],[99.6314,0.3473,-0.001,0.0499,-0.1346,-2.8535,3.065,-6.4997,-4.9829,-0.0354,-0.0379,0.0681,-0.0284]];

const SBP_F = [[-7.4855,0.7114,-0.0066,-0.0667,0.3564,-1.2252,1.2643,-6.8797,20.4744,-0.0012,0.5278,-0.6927,0.1388],[8.4462,0.5919,-0.0029,-0.065,0.2495,-0.9598,0.9046,-5.1098,15.1548,-0.003,0.4421,-0.5724,0.0997],[26.6223,0.475,0.0001,-0.0643,0.2062,-1.1479,1.2134,-8.4665,28.0408,-0.023,0.5561,-0.7467,0.185],[31.8947,0.4251,-0.0002,-0.0535,0.1718,-0.867,1.1693,-8.2932,26.0849,-0.008,0.3954,-0.5402,0.1473],[30.9472,0.4578,-0.0019,-0.0341,0.1144,-1.1288,1.5926,-11.7371,34.5934,-0.0167,0.6897,-1.0025,0.3867],[23.152,0.527,-0.0048,-0.0149,0.0623,-1.1368,1.751,-13.8556,41.2104,0.0062,0.4347,-0.6509,0.2798],[19.3036,0.5494,-0.0062,-0.0051,0.0555,-0.923,1.6566,-14.2294,42.9522,0.0242,0.1295,-0.1986,0.0876],[20.0191,0.5596,-0.0071,0.0146,-0.03,-1.0378,1.6928,-13.6476,40.8615,0.0135,0.1632,-0.2423,0.1013],[21.6515,0.5462,-0.0063,0.0087,-0.0183,-0.9745,1.5964,-13.0096,38.8309,0.0093,0.2644,-0.3848,0.1477],[22.6952,0.537,-0.0066,0.0176,-0.0648,-0.8665,1.4799,-11.8203,34.2277,0.0046,0.3226,-0.4689,0.1811],[23.1615,0.5329,-0.0063,0.013,-0.0367,-0.8132,1.4422,-11.8893,34.8542,0.008,0.34,-0.5072,0.2171],[27.9,0.4995,-0.0049,0.0013,0.0117,-0.8288,1.4257,-11.5803,33.7393,-0.0014,0.4954,-0.7333,0.3051],[34.8678,0.4469,-0.0037,-0.0037,0.0274,-0.801,1.429,-11.2835,32.3656,-0.0004,0.3936,-0.5873,0.251],[37.7557,0.4392,-0.0035,0.0024,-0.0164,-0.9638,1.5603,-11.545,31.5671,-0.0087,0.395,-0.575,0.2238],[39.9509,0.4284,-0.0032,0.0051,-0.0452,-1.0185,1.6189,-11.6485,31.009,-0.0101,0.3516,-0.5073,0.1906],[40.8576,0.418,-0.0029,0.0019,-0.0291,-0.9313,1.5386,-11.5031,31.8413,-0.0081,0.3507,-0.5094,0.1968],[42.1455,0.4098,-0.0029,0.0038,-0.0368,-0.9104,1.5356,-11.4411,31.5567,-0.006,0.2848,-0.4155,0.1642],[44.0009,0.4038,-0.0026,0.0007,-0.0172,-1.0103,1.6565,-11.8711,31.8672,-0.0017,0.1877,-0.2802,0.1211],[42.9483,0.4097,-0.0029,0.0023,-0.0231,-0.9479,1.6532,-12.4439,34.3937,-0.0003,0.1892,-0.2761,0.1077],[43.4489,0.4076,-0.0027,0,-0.0199,-0.9355,1.5751,-11.4463,30.9525,0.0013,0.1619,-0.2376,0.0949],[42.0432,0.4235,-0.003,0.0009,-0.0194,-0.9668,1.5892,-11.2769,29.6658,0.0051,0.1181,-0.1781,0.0784],[43.3921,0.4122,-0.0025,-0.0008,-0.0269,-0.9251,1.5125,-10.669,27.8566,-0.0003,0.178,-0.2571,0.0962],[43.1823,0.4154,-0.0028,0.0025,-0.0386,-0.9153,1.5502,-11.2058,29.7148,0.0053,0.0679,-0.0977,0.0352],[43.5111,0.4107,-0.0027,0.0019,-0.0416,-0.8427,1.4724,-10.8634,29.5168,-0.0023,0.1644,-0.2282,0.0711],[44.8115,0.4087,-0.003,0.012,-0.0908,-0.9195,1.5496,-10.7815,27.8384,-0.0063,0.1451,-0.1957,0.053],[45.1153,0.404,-0.003,0.0148,-0.1094,-0.8419,1.4685,-10.4821,27.7389,-0.0047,0.1524,-0.2131,0.0715],[45.0184,0.4124,-0.0031,0.0163,-0.1196,-0.9109,1.4637,-9.8769,25.3956,-0.0095,0.2128,-0.3015,0.1084],[46.8396,0.4004,-0.0025,0.0087,-0.0854,-0.9336,1.4913,-10.0409,25.5791,-0.0083,0.207,-0.2945,0.1065],[46.3627,0.4156,-0.003,0.0128,-0.0892,-1.0691,1.6403,-10.8997,27.3749,-0.006,0.1891,-0.2783,0.1168],[46.056,0.4169,-0.0032,0.0134,-0.0831,-1.0253,1.6174,-10.8914,27.6133,-0.0015,0.1168,-0.1751,0.0794],[45.8707,0.4234,-0.0035,0.0189,-0.1052,-1.0687,1.6929,-11.5282,29.3823,-0.002,0.0549,-0.0766,0.0279],[46.225,0.4212,-0.0032,0.015,-0.0892,-1.0493,1.6305,-11.0002,28.295,0.001,0.0192,-0.0279,0.014],[49.7043,0.4005,-0.0027,0.0175,-0.1166,-1.1168,1.6687,-10.6909,26.5418,-0.0029,-0.0064,0.0124,-0.0056],[52.501,0.39,-0.0025,0.0229,-0.1413,-1.2283,1.7174,-10.288,24.6009,-0.0055,-0.0773,0.1151,-0.0428],[52.638,0.393,-0.0027,0.0233,-0.1352,-1.2668,1.7982,-10.7251,24.8323,-0.0037,-0.1218,0.1797,-0.0678],[52.9451,0.3952,-0.0028,0.0249,-0.1365,-1.2987,1.8214,-10.8739,25.4383,-0.0026,-0.1753,0.2588,-0.1002],[51.6977,0.4024,-0.0032,0.0273,-0.1377,-1.2275,1.7723,-10.6355,24.5465,0.0023,-0.2334,0.3428,-0.1327],[51.5803,0.4027,-0.0033,0.029,-0.1504,-1.1856,1.7323,-10.549,24.7169,0.004,-0.2752,0.4081,-0.1658],[52.5542,0.3978,-0.0032,0.0312,-0.1661,-1.1951,1.7357,-10.3953,23.5706,0.0005,-0.2249,0.34,-0.1482],[54.7146,0.3869,-0.0029,0.0332,-0.1862,-1.2604,1.8028,-10.773,24.4075,-0.002,-0.2181,0.3306,-0.1449],[56.735,0.3684,-0.0025,0.0319,-0.1874,-1.199,1.8011,-11.3328,26.8609,0.0002,-0.2443,0.3686,-0.1611],[57.7385,0.3657,-0.0024,0.0287,-0.1704,-1.2515,1.8588,-11.3519,25.8098,-0.0009,-0.2306,0.3502,-0.1567],[57.7098,0.3677,-0.0024,0.0271,-0.1572,-1.257,1.9037,-11.8077,27.0173,-0.0012,-0.1965,0.298,-0.1324],[58.0736,0.3643,-0.0024,0.0253,-0.1507,-1.2363,1.9353,-12.317,28.6066,0.002,-0.178,0.2641,-0.1092],[62.0223,0.3343,-0.0016,0.0242,-0.1555,-1.2128,1.9237,-12.157,27.903,-0.0004,-0.21,0.315,-0.136],[62.1221,0.3308,-0.0017,0.026,-0.1685,-1.1404,1.8555,-11.839,27.3698,-0.0024,-0.1452,0.2208,-0.0993],[62.7962,0.3253,-0.0016,0.0282,-0.1884,-1.113,1.8421,-11.7266,26.7715,-0.0019,-0.1808,0.2766,-0.1276],[61.7073,0.3435,-0.0022,0.0321,-0.2009,-1.2183,1.9323,-12.0462,26.8742,-0.0018,-0.1943,0.2958,-0.1342],[61.7636,0.342,-0.0022,0.0308,-0.1956,-1.1885,1.9597,-12.4946,27.9124,0.003,-0.234,0.3493,-0.149],[63.7493,0.3283,-0.0012,0.0195,-0.1595,-1.2055,1.96,-12.5069,28.0089,-0.002,-0.1708,0.2634,-0.1258],[62.2586,0.3328,-0.0012,0.0137,-0.1292,-1.077,1.8646,-12.2702,27.8184,-0.0024,-0.0705,0.1151,-0.0646],[64.2911,0.3191,-0.0007,0.0088,-0.1057,-1.0805,1.8431,-11.8647,26.3816,-0.007,-0.0325,0.0621,-0.0471],[68.9778,0.294,0.0003,0.0053,-0.0991,-1.2187,1.888,-11.2553,23.9127,-0.0123,-0.0668,0.1121,-0.0648],[70.4806,0.2801,0.0009,0.0001,-0.0853,-1.165,1.8218,-10.7395,22.4622,-0.0136,-0.0702,0.1225,-0.0781],[70.6109,0.2768,0.001,-0.0007,-0.084,-1.1182,1.8262,-11.2854,24.8046,-0.01,-0.1092,0.1806,-0.1041],[69.8975,0.287,0.0007,0.0018,-0.0954,-1.1611,1.8731,-11.7046,26.3452,-0.0067,-0.1524,0.2386,-0.1185],[69.191,0.2928,0.0003,0.0055,-0.111,-1.1401,1.9015,-12.217,27.9129,-0.0035,-0.2103,0.3262,-0.1586],[69.9619,0.2873,0.0005,0.0046,-0.1118,-1.1195,1.8816,-11.9235,26.817,-0.0053,-0.1918,0.3015,-0.1525],[68.3161,0.2951,0.0003,0.0028,-0.1008,-1.0128,1.7759,-11.6001,26.6764,-0.0022,-0.2321,0.3639,-0.1831],[68.0555,0.2927,0.0006,-0.0014,-0.0813,-0.9162,1.6469,-10.7107,24.2868,-0.0004,-0.236,0.3707,-0.1882],[65.6124,0.3055,0.0004,-0.0054,-0.0567,-0.7989,1.5036,-9.8072,21.9786,-0.0017,-0.1403,0.2328,-0.1369],[65.1636,0.3086,0.0005,-0.0086,-0.0391,-0.7707,1.457,-9.5828,21.8374,-0.0024,-0.0941,0.1647,-0.109],[66.6766,0.3073,0.0008,-0.0116,-0.029,-0.913,1.5894,-9.8498,21.1477,-0.0052,-0.0645,0.1189,-0.0865],[65.4537,0.3178,0.0007,-0.0136,-0.0176,-0.895,1.5329,-9.3616,19.7235,-0.0044,-0.0173,0.0444,-0.0479],[64.8596,0.3274,0.0002,-0.0077,-0.0396,-0.9404,1.6229,-9.8355,19.8054,-0.006,0.0077,0.0094,-0.0359],[64.7808,0.3302,0.0002,-0.0082,-0.0324,-0.935,1.5826,-9.392,18.2771,-0.009,0.0629,-0.0712,-0.0032],[65.5762,0.3289,0.0003,-0.009,-0.0304,-0.9693,1.558,-8.833,16.6679,-0.0092,0.0526,-0.0599,-0.0011],[64.0451,0.3537,-0.0007,0.0019,-0.0701,-1.1203,1.7205,-9.4755,16.9051,-0.0041,-0.1202,0.1997,-0.1156],[66.825,0.3397,-0.0006,0.0056,-0.0822,-1.1964,1.8333,-10.0226,17.9273,-0.0081,-0.1245,0.2047,-0.1138],[65.6846,0.3537,-0.0009,0.0036,-0.066,-1.2525,1.9018,-10.459,18.6882,-0.0057,-0.113,0.1831,-0.0985],[65.3052,0.3604,-0.0013,0.0085,-0.0848,-1.2617,1.9135,-10.5223,18.771,-0.0046,-0.1438,0.2265,-0.112],[64.899,0.3641,-0.0016,0.0138,-0.1073,-1.2245,1.8584,-10.1192,17.7416,-0.0048,-0.1372,0.2161,-0.1063],[65.3578,0.3627,-0.0014,0.0124,-0.1066,-1.2248,1.8289,-9.7674,16.8046,-0.0057,-0.1576,0.2502,-0.1263],[64.5514,0.3687,-0.0013,0.0091,-0.0924,-1.1783,1.7442,-9.4075,16.9106,-0.0076,-0.0787,0.1365,-0.0847],[66.0885,0.3605,-0.0016,0.0179,-0.1274,-1.1878,1.7936,-9.5264,16.3425,-0.0072,-0.185,0.2994,-0.1608],[67.302,0.3551,-0.0016,0.0212,-0.1358,-1.1912,1.725,-8.4639,12.8607,-0.0076,-0.2055,0.3238,-0.1601],[69.6151,0.3387,-0.0015,0.026,-0.1521,-1.1726,1.7606,-8.9219,14.4437,-0.0094,-0.1704,0.2659,-0.1257],[70.5901,0.3388,-0.0016,0.0283,-0.1619,-1.2426,1.8162,-8.921,13.7988,-0.016,-0.066,0.1157,-0.069],[74.0399,0.322,-0.001,0.0261,-0.1607,-1.3696,1.9736,-9.9705,16.4081,-0.0211,0.054,-0.068,0.017],[78.1837,0.2962,-0.0004,0.0279,-0.176,-1.4118,1.9659,-9.2285,13.6521,-0.0236,0.0265,-0.035,0.0171],[77.8733,0.3117,-0.0013,0.041,-0.234,-1.5496,2.1217,-10.0164,15.085,-0.0167,-0.141,0.2059,-0.0717],[78.6258,0.311,-0.0011,0.0374,-0.2191,-1.5819,2.1292,-10.2662,16.5876,-0.0181,-0.0881,0.1294,-0.044],[78.1114,0.3231,-0.0016,0.0421,-0.2369,-1.6551,2.2258,-11.1197,18.7127,-0.0174,-0.0626,0.0903,-0.0264],[79.7562,0.3146,-0.0013,0.038,-0.2147,-1.6836,2.2862,-11.9207,21.9312,-0.0164,-0.0397,0.0537,-0.0083],[81.1825,0.3106,-0.0011,0.0381,-0.2099,-1.7413,2.3012,-11.7683,21.4169,-0.0197,0.0394,-0.07,0.0551],[82.4317,0.3043,-0.0014,0.0468,-0.2545,-1.7326,2.3369,-11.7377,20.8323,-0.0145,-0.1069,0.1451,-0.0329],[83.4279,0.3009,-0.0009,0.0394,-0.2205,-1.7479,2.3341,-12.1336,23.8773,-0.0159,-0.0384,0.039,0.0189],[87.5318,0.2804,0,0.0344,-0.215,-1.8801,2.4042,-11.8201,21.5,-0.0208,-0.0131,0.0053,0.0276],[91.5471,0.2576,0.0005,0.0374,-0.2444,-1.9424,2.5247,-12.4507,21.7964,-0.0294,-0.0119,0.0227,-0.01],[92.4497,0.2495,0,0.0494,-0.305,-1.8508,2.5523,-13.6421,26.226,-0.0184,-0.1813,0.2673,-0.1041],[92.8328,0.2436,0.0005,0.0322,-0.2188,-1.7523,2.5128,-13.17,23.6191,-0.0162,-0.1657,0.2435,-0.0938],[100.346,0.2061,0.0016,0.0236,-0.1616,-1.9852,2.7015,-12.334,16.8429,-0.0093,-0.4796,0.6954,-0.2616],[106.8231,0.1537,0.0038,0.0071,-0.1169,-1.8617,2.4704,-10.3756,11.994,-0.0192,-0.4992,0.7439,-0.3113],[111.3953,0.1324,0.0046,0.0068,-0.1417,-1.9833,2.5967,-11.4122,16.0199,-0.0242,-0.6418,0.9712,-0.431],[117.6411,0.0991,0.0053,0.0132,-0.1836,-2.0964,2.6981,-11.2572,13.4182,-0.0338,-0.4799,0.719,-0.3037],[121.3735,0.0974,0.0055,0.0085,-0.1487,-2.3828,2.9534,-12.2263,14.8292,-0.0205,-0.6271,0.9041,-0.3313],[115.9126,0.1601,0.0028,0.0231,-0.181,-2.5317,3.2788,-15.2093,22.0287,0.0006,-0.7258,1.0194,-0.3341],[125.5877,0.0405,0.006,-0.0009,-0.0707,-1.6743,2.6055,-13.4481,23.2621,0.0296,-1.1873,1.6794,-0.5743],[135.675,-0.0112,0.0136,-0.0896,0.1678,-1.8473,2.0605,-8.0487,16.9201,-0.0337,0.3359,-0.5938,0.4196]];

const DBP_M = [[-13.567,0.4118,0.0003,-0.0263,0.0507,-1.1325,-1.7078,28.8607,-81.1719,-0.0087,-0.1202,0.2977,-0.2691],[-43.7777,0.4741,-0.0029,-0.0496,0.1518,1.9512,-3.8763,28.8717,-57.6407,-0.0191,0.1992,-0.2879,0.0508],[-35.5221,0.4425,-0.0025,-0.0428,0.1269,1.6542,-3.2001,22.4882,-41.299,-0.0674,0.3133,-0.465,0.1062],[-25.9772,0.3556,0.0003,-0.0543,0.1499,2.0924,-3.8188,24.4956,-38.8551,-0.0796,0.4423,-0.7299,0.2906],[-16.9931,0.2916,0.0006,-0.0481,0.1416,2.2497,-3.7873,23.1323,-35.1791,-0.0641,0.3962,-0.6572,0.2638],[-19.6683,0.3203,-0.0015,-0.0388,0.1406,2.3137,-3.7117,22.8638,-35.7152,-0.0689,0.4499,-0.7699,0.3469],[-33.2858,0.3986,-0.0021,-0.0592,0.2053,2.7679,-4.0941,22.3138,-27.6548,-0.0938,0.6243,-1.0803,0.5056],[-42.522,0.4632,-0.0051,-0.0392,0.1567,3.0229,-4.2155,22.1584,-27.6854,-0.0631,0.512,-0.8671,0.3759],[-34.2517,0.4233,-0.0055,-0.0269,0.1286,2.7721,-3.6109,17.4453,-15.4161,-0.0371,0.366,-0.6077,0.2427],[-42.4833,0.466,-0.0072,-0.0191,0.1105,3.1554,-3.8233,16.9605,-12.0012,-0.0294,0.3572,-0.5855,0.2225],[-54.4375,0.569,-0.0112,-0.0014,0.0879,3.0764,-3.5785,15.2542,-9.8518,-0.034,0.4004,-0.6627,0.2631],[-38.5925,0.5015,-0.0094,0.0059,0.0528,2.3768,-3.1326,15.4931,-14.1216,-0.0475,0.355,-0.5818,0.2245],[-40.8119,0.5119,-0.0092,0.0039,0.0554,2.5241,-3.3547,16.1453,-12.993,-0.0504,0.3968,-0.6637,0.2771],[-46.3014,0.5495,-0.0106,0.0106,0.0468,2.6717,-3.5156,16.4588,-11.9729,-0.0493,0.4299,-0.7314,0.3246],[-47.6314,0.5434,-0.0102,0.0067,0.0518,2.9586,-3.758,16.7192,-10.3567,-0.0595,0.4837,-0.8241,0.3686],[-41.6665,0.4983,-0.0073,-0.0149,0.0964,2.9392,-3.8754,17.5857,-10.8233,-0.0817,0.5737,-0.987,0.4563],[-45.7369,0.5321,-0.008,-0.0146,0.1016,2.9396,-3.8633,17.231,-10.561,-0.0765,0.5824,-1.0084,0.4748],[-51.929,0.586,-0.0101,-0.0013,0.0747,2.9378,-3.7832,15.9238,-7.0752,-0.0647,0.5498,-0.9515,0.4469],[-45.8559,0.5356,-0.0086,-0.0063,0.0786,3.0516,-3.9216,17.0729,-10.1336,-0.0616,0.5196,-0.8956,0.415],[-39.5605,0.5025,-0.0082,-0.003,0.0687,2.8551,-3.5847,14.9465,-5.3128,-0.0683,0.5134,-0.8848,0.4109],[-33.7657,0.4575,-0.0075,-0.0012,0.0596,2.9223,-3.533,14.1257,-2.6863,-0.0664,0.4876,-0.8388,0.3872],[-32.281,0.472,-0.0081,0.0063,0.0419,2.6018,-3.2278,12.8399,-0.8793,-0.062,0.4496,-0.7751,0.3605],[-31.5797,0.4845,-0.0091,0.0143,0.0265,2.3929,-2.9101,11.2038,1.5782,-0.0586,0.4152,-0.712,0.3258],[-32.2816,0.4779,-0.0097,0.0203,0.0104,2.6349,-3.0487,11.5875,0.5188,-0.044,0.3694,-0.6297,0.2818],[-25.44,0.421,-0.007,0.0038,0.0396,2.7183,-3.2535,13.5284,-4.0414,-0.0469,0.3676,-0.6261,0.2792],[-22.8873,0.4141,-0.0056,-0.0066,0.0583,2.5652,-3.2543,13.672,-3.1603,-0.0566,0.3787,-0.6382,0.2747],[-20.7911,0.3921,-0.0042,-0.015,0.0686,2.6849,-3.4699,14.9131,-5.2628,-0.0663,0.3974,-0.6642,0.2789],[-18.557,0.3937,-0.0045,-0.0121,0.0655,2.4292,-3.0989,12.2737,1.0228,-0.073,0.4005,-0.667,0.277],[-17.5306,0.3838,-0.0047,-0.009,0.0598,2.5085,-3.1093,11.7413,3.3022,-0.0637,0.3744,-0.6243,0.2595],[-14.3488,0.3712,-0.004,-0.0129,0.0679,2.3673,-3.0068,11.4653,3.7471,-0.0681,0.3759,-0.6244,0.2561],[-16.6395,0.3924,-0.0047,-0.0114,0.0678,2.3516,-2.9622,11.2382,3.1551,-0.0675,0.3777,-0.6258,0.2543],[-10.6475,0.3509,-0.0034,-0.0169,0.0752,2.2971,-2.8656,10.1755,7.4446,-0.0763,0.3958,-0.6548,0.2643],[-10.0847,0.3368,-0.0033,-0.0182,0.08,2.4662,-2.9361,10.2311,6.9534,-0.073,0.3922,-0.6484,0.2607],[-9.646,0.3398,-0.0036,-0.0141,0.0709,2.4037,-2.8587,10.171,5.6614,-0.0667,0.3688,-0.6116,0.2487],[-5.5,0.3246,-0.003,-0.0129,0.0635,2.2058,-2.7946,11.4006,-0.0691,-0.0713,0.3492,-0.5757,0.231],[-3.1184,0.3161,-0.0025,-0.0137,0.0596,2.0845,-2.7566,11.9122,-2.7527,-0.0779,0.347,-0.5661,0.2186],[-1.8889,0.3178,-0.0027,-0.01,0.0505,1.938,-2.5612,10.5284,0.4557,-0.0868,0.3703,-0.6072,0.2401],[1.3652,0.3031,-0.002,-0.0117,0.0496,1.8159,-2.5509,11.3987,-2.5982,-0.095,0.3856,-0.6354,0.2568],[4.1129,0.2849,-0.0018,-0.0081,0.038,1.8155,-2.5332,11.0415,-0.7368,-0.0883,0.364,-0.6035,0.2493],[1.4862,0.295,-0.0018,-0.0113,0.0461,1.9999,-2.7504,12.2222,-3.4789,-0.0881,0.3736,-0.6168,0.2503],[-2.474,0.3229,-0.0028,-0.0094,0.0487,2.0859,-2.8319,12.5224,-3.8212,-0.086,0.392,-0.6551,0.2772],[-0.415,0.3217,-0.0029,-0.0082,0.0472,1.9078,-2.6838,12.7489,-6.852,-0.0801,0.3635,-0.6077,0.2576],[-0.0497,0.3277,-0.0029,-0.0071,0.0414,1.8113,-2.6253,12.8018,-7.7129,-0.0794,0.3497,-0.5807,0.2402],[-1.5833,0.3439,-0.003,-0.0061,0.0371,1.7827,-2.6894,13.4925,-9.1732,-0.0845,0.3665,-0.6098,0.2548],[1.209,0.3277,-0.0027,-0.0052,0.0323,1.7298,-2.6076,12.8518,-6.9268,-0.087,0.3703,-0.6203,0.2656],[1.2834,0.335,-0.0025,-0.0086,0.0415,1.6318,-2.5106,12.1368,-4.9164,-0.0924,0.386,-0.6467,0.2773],[-0.4438,0.3463,-0.0031,-0.0075,0.0435,1.6936,-2.4801,11.7414,-4.8147,-0.0895,0.3834,-0.6422,0.2749],[-0.2325,0.3529,-0.0033,-0.0065,0.0434,1.613,-2.4272,12.1673,-8.1046,-0.0851,0.3606,-0.6019,0.2545],[-2.1989,0.3643,-0.0037,-0.0061,0.0459,1.6982,-2.4926,12.7697,-10.7769,-0.0859,0.3821,-0.6441,0.2821],[-0.8411,0.3572,-0.004,-0.0005,0.0305,1.6919,-2.4301,12.0592,-8.667,-0.0865,0.3748,-0.6317,0.2776],[0.1678,0.3552,-0.0038,-0.0004,0.0275,1.6387,-2.3829,11.423,-6.0839,-0.0933,0.3894,-0.6552,0.2867],[0.8079,0.3404,-0.0029,-0.0096,0.0477,1.7778,-2.4652,11.0582,-4.0097,-0.0928,0.4036,-0.6792,0.2963],[-1.1219,0.3561,-0.0036,-0.0078,0.0484,1.8103,-2.4361,10.7708,-4.1791,-0.0819,0.3736,-0.6278,0.2717],[-4.8133,0.3871,-0.0049,-0.0019,0.0409,1.8058,-2.331,9.8828,-2.9487,-0.0736,0.3513,-0.5879,0.2503],[-8.1979,0.4011,-0.0058,0.0028,0.0321,2.0298,-2.494,10.6089,-5.3076,-0.0692,0.3504,-0.5851,0.247],[-6.752,0.3884,-0.0055,0.0002,0.0371,2.0613,-2.4814,10.131,-3.6573,-0.0753,0.3769,-0.6294,0.2655],[-3.566,0.3807,-0.005,-0.0007,0.0371,1.8329,-2.2802,9.0883,-0.4962,-0.081,0.3819,-0.6401,0.2738],[1.0387,0.3494,-0.0037,-0.0064,0.0437,1.7975,-2.2844,9.2486,-0.6268,-0.0821,0.3621,-0.6004,0.2472],[1.6962,0.3625,-0.0033,-0.0098,0.0505,1.5592,-2.1909,9.9497,-4.5187,-0.0904,0.364,-0.5976,0.2383],[1.7174,0.3556,-0.0029,-0.0144,0.0602,1.6924,-2.3499,11.1189,-8.075,-0.0871,0.3514,-0.5716,0.2195],[-1.1808,0.3668,-0.0036,-0.0124,0.0586,1.896,-2.4788,11.4555,-8.5302,-0.0775,0.3326,-0.5377,0.2006],[-1.9286,0.3747,-0.0042,-0.0079,0.0509,1.8974,-2.4107,10.6569,-6.2357,-0.0731,0.3224,-0.5217,0.1951],[-0.6762,0.3859,-0.0052,0.0017,0.0314,1.6316,-2.0498,8.2301,-0.4293,-0.0748,0.3067,-0.4907,0.1753],[0.0177,0.398,-0.006,0.0074,0.0231,1.3931,-1.7224,6.2104,3.67,-0.0781,0.3064,-0.4907,0.1763],[1.8242,0.381,-0.0045,-0.0055,0.0517,1.4415,-1.8531,7.4867,0.3209,-0.0808,0.3148,-0.504,0.181],[3.3864,0.3667,-0.0046,-0.0044,0.0516,1.5296,-1.8957,8.1805,-2.714,-0.0669,0.2582,-0.4028,0.1272],[1.4518,0.3836,-0.0047,-0.0045,0.0515,1.5557,-2.0588,9.891,-7.5275,-0.0676,0.2556,-0.3964,0.1218],[-0.2228,0.3835,-0.0048,-0.0063,0.0572,1.7851,-2.3148,11.3445,-10.9345,-0.0663,0.2738,-0.4312,0.1425],[-1.2686,0.3885,-0.0049,-0.0053,0.0531,1.848,-2.3626,11.0795,-8.9995,-0.0765,0.3143,-0.5003,0.1745],[-1.1771,0.382,-0.0052,-0.0022,0.0473,1.9498,-2.33,9.7844,-3.6954,-0.0778,0.3354,-0.5421,0.202],[-1.5905,0.39,-0.0063,0.0071,0.0279,1.9246,-2.2012,8.7588,-1.7051,-0.0723,0.315,-0.5067,0.1847],[1.3907,0.3789,-0.006,0.0072,0.0262,1.7403,-1.9434,6.9646,2.6064,-0.0787,0.3279,-0.5282,0.1939],[5.7059,0.3493,-0.0054,0.0068,0.0244,1.724,-1.9265,7.7741,-2.061,-0.0694,0.282,-0.4467,0.1515],[12.6597,0.3265,-0.0048,0.0144,-0.0045,1.3459,-1.7148,8.837,-8.9553,-0.065,0.1958,-0.2892,0.0669],[14.3993,0.3118,-0.0037,0.0089,-0.0004,1.3957,-1.9442,11.1527,-15.7051,-0.0745,0.2201,-0.3286,0.0822],[17.6818,0.2899,-0.0031,0.0095,-0.0089,1.388,-1.9866,11.7883,-17.7697,-0.0708,0.1938,-0.2807,0.056],[11.917,0.3206,-0.0046,0.0186,-0.0278,1.6817,-2.3045,13.3873,-21.1645,-0.0691,0.2114,-0.3145,0.0776],[9.2777,0.3418,-0.0056,0.0253,-0.0412,1.6967,-2.2055,11.4045,-13.2029,-0.0758,0.2487,-0.3832,0.1165],[5.8584,0.3719,-0.0073,0.0382,-0.0675,1.6874,-2.0515,9.5688,-8.1664,-0.0715,0.2508,-0.3923,0.1289],[9.3245,0.3581,-0.0073,0.0413,-0.0754,1.5374,-1.8954,9.7989,-11.7858,-0.063,0.2057,-0.3147,0.0928],[16.2286,0.3267,-0.0058,0.0385,-0.0835,1.2597,-1.7964,11.1013,-18.2966,-0.0656,0.1577,-0.2201,0.0326],[15.2268,0.3504,-0.0059,0.0373,-0.0777,1.0841,-1.7857,12.168,-22.5467,-0.0718,0.1751,-0.253,0.0528],[10.4724,0.3634,-0.0056,0.0276,-0.0497,1.4733,-2.2295,13.8392,-23.1801,-0.0848,0.2636,-0.4153,0.1436],[5.2365,0.4039,-0.0071,0.0317,-0.0486,1.5165,-2.1802,12.4214,-17.9441,-0.0919,0.3179,-0.5147,0.1988],[10.1259,0.3722,-0.0063,0.0273,-0.0379,1.4465,-1.9666,11.6878,-19.1724,-0.0743,0.2451,-0.3873,0.1349],[8.7996,0.3767,-0.006,0.0209,-0.0216,1.6042,-2.2123,13.8638,-26.1613,-0.0624,0.2044,-0.3117,0.0907],[7.3808,0.366,-0.0058,0.0184,-0.0173,1.9753,-2.5467,14.6551,-24.7762,-0.0685,0.2633,-0.4213,0.1535],[8.2409,0.3742,-0.008,0.033,-0.0361,1.8093,-1.8703,8.5537,-10.4574,-0.0481,0.1904,-0.2951,0.0924],[16.3443,0.3376,-0.0067,0.028,-0.0305,1.4613,-1.5844,8.5531,-13.7014,-0.0421,0.1473,-0.2208,0.0564],[13.6814,0.3408,-0.0062,0.0239,-0.0268,1.7899,-2.0949,11.8906,-20.3017,-0.0499,0.1898,-0.2958,0.0953],[-2.2305,0.4491,-0.0095,0.0277,-0.0118,2.0458,-2.0636,8.7608,-9.0684,-0.0522,0.2641,-0.4295,0.1659],[7.1024,0.4266,-0.0107,0.0507,-0.0701,1.4245,-1.2884,5.4006,-5.1633,-0.0223,0.0801,-0.0982,-0.0105],[22.5224,0.3231,-0.008,0.0497,-0.0852,1.2411,-1.1587,5.4827,-6.229,-0.035,0.0837,-0.1047,-0.0066],[7.1688,0.3913,-0.0079,0.0285,-0.027,2.0574,-2.1429,8.7073,-6.973,-0.0746,0.3209,-0.5246,0.2072],[10.9219,0.3914,-0.0095,0.0458,-0.0634,1.7121,-1.5447,6.0756,-5.588,-0.034,0.1515,-0.2269,0.0567],[0.0292,0.5124,-0.0137,0.0821,-0.1555,1.3826,-1.5163,7.1831,-10.5716,-0.0443,0.1613,-0.2416,0.0645],[-7.4708,0.5394,-0.0152,0.0752,-0.1166,1.924,-1.6304,5.8484,-7.4136,-0.0193,0.205,-0.3492,0.1599],[17.4158,0.3737,-0.0096,0.0478,-0.0772,1.6902,-1.3304,3.6898,3.0431,-0.0183,0.131,-0.2054,0.0662],[-2.725,0.4042,-0.0133,0.0238,0.0586,3.8134,-2.3052,3.5243,8.0191,0.0627,0.0422,-0.052,-0.018]];

const DBP_F = [[36.3363,-0.0182,0.0007,0.0464,-0.2691,-0.4513,-0.2328,28.8499,-129.833,-0.0622,-0.2979,0.6276,-0.5522],[30.6534,0.1058,0.0021,0.039,-0.2859,-1.0645,-0.5369,30.836,-125.69,-0.0568,-0.8988,1.5116,-0.9035],[46.6521,-0.0091,0.0049,0.0484,-0.379,-0.8427,-0.8134,29.0051,-109.524,-0.0684,-0.6066,1.0179,-0.5945],[34.7995,0.1143,0.0006,0.0856,-0.4757,-1.0943,-0.5132,24.8976,-93.9462,-0.03,-0.9349,1.424,-0.6362],[15.9095,0.2253,-0.0045,0.1041,-0.5073,-0.3518,-0.6484,19.5391,-72.0796,0.007,-1.3455,2.0777,-0.9953],[12.8878,0.2379,-0.002,0.0402,-0.2008,-0.0974,-1.0427,20.0319,-66.1203,-0.0112,-0.4679,0.7618,-0.4226],[3.2759,0.3223,-0.0044,0.0485,-0.2089,-0.1741,-0.7763,16.2511,-53.8662,-0.0061,-0.2448,0.4092,-0.2385],[12.846,0.2474,-0.0022,0.0311,-0.123,-0.0649,-0.8792,16.2183,-50.693,-0.0255,0.239,-0.3265,0.1012],[12.8668,0.2361,-0.002,0.0293,-0.1263,0.1716,-1.0619,16.2814,-49.2028,-0.0322,0.5303,-0.7561,0.2762],[9.112,0.2737,-0.0032,0.0416,-0.1676,0.1408,-1.0811,16.1015,-48.0962,-0.0278,0.5837,-0.8523,0.3437],[11.7225,0.284,-0.0034,0.0505,-0.203,-0.2667,-0.674,14.1978,-45.5872,-0.0368,0.5673,-0.8255,0.3314],[19.5753,0.2384,-0.002,0.0503,-0.2232,-0.4609,-0.4453,12.7133,-41.9359,-0.0503,0.7475,-1.0987,0.4581],[21.1297,0.2491,-0.0015,0.0462,-0.2201,-0.7489,-0.2784,12.1653,-40.6521,-0.0415,0.5736,-0.8537,0.3742],[17.5087,0.2699,-0.0017,0.0438,-0.2286,-0.5589,-0.5804,13.6135,-42.3595,-0.0325,0.5451,-0.8138,0.3581],[19.125,0.2679,-0.0009,0.0341,-0.1992,-0.6931,-0.358,11.3984,-35.5973,-0.0272,0.3386,-0.5034,0.2204],[12.3312,0.3246,-0.002,0.0272,-0.1474,-0.7307,-0.2314,9.1993,-27.9046,-0.0218,0.4218,-0.6267,0.2695],[8.7933,0.3473,-0.0031,0.0313,-0.1447,-0.5755,-0.2574,8.5358,-26.1118,-0.0249,0.4514,-0.6549,0.2572],[6.8234,0.3781,-0.0044,0.0462,-0.203,-0.7262,-0.0687,7.7821,-26.4927,-0.0214,0.2612,-0.3714,0.1375],[6.5708,0.3759,-0.0041,0.0378,-0.1688,-0.6226,-0.1738,8.0763,-26.5849,-0.0223,0.3339,-0.475,0.1725],[12.4952,0.3431,-0.0032,0.0368,-0.1732,-0.781,0.0532,6.8239,-24.2698,-0.0262,0.1513,-0.1909,0.0331],[16.8254,0.2885,-0.0021,0.0295,-0.1608,-0.4175,-0.2206,7.4894,-23.9702,-0.0154,-0.0241,0.0763,-0.095],[17.8811,0.2868,-0.0028,0.0392,-0.1928,-0.4367,-0.1266,7.0389,-24.15,-0.0081,-0.278,0.4577,-0.2641],[16.5734,0.2899,-0.0032,0.0387,-0.1806,-0.2666,-0.2542,7.0108,-22.3832,-0.0041,-0.2653,0.436,-0.2519],[19.9011,0.2636,-0.002,0.0303,-0.1519,-0.2317,-0.3427,7.6601,-23.4789,-0.0146,-0.0788,0.162,-0.1394],[21.7218,0.2553,-0.0023,0.0347,-0.1547,-0.2625,-0.2345,6.6903,-20.9185,-0.023,0.0302,0.0052,-0.0801],[21.9955,0.2719,-0.0028,0.0392,-0.1593,-0.4947,-0.0505,6.3827,-21.7936,-0.0334,0.1394,-0.1536,-0.0152],[25.2014,0.2566,-0.0032,0.0512,-0.2028,-0.5716,0.0877,5.7268,-21.1119,-0.0358,0.0855,-0.0747,-0.0456],[24.9355,0.2671,-0.0039,0.0592,-0.2224,-0.6578,0.231,4.6551,-18.8514,-0.0268,-0.0489,0.114,-0.1096],[23.5259,0.2698,-0.004,0.0557,-0.2087,-0.5069,0.1119,4.7744,-18.0734,-0.0263,0.0265,0.0098,-0.0803],[22.6538,0.2682,-0.0033,0.0439,-0.1629,-0.3685,-0.0683,5.5225,-18.8175,-0.0299,0.2232,-0.2808,0.039],[25.1343,0.2571,-0.0028,0.0398,-0.1488,-0.4732,0.0854,3.9605,-13.912,-0.038,0.4146,-0.5644,0.1571],[26.0776,0.2526,-0.0028,0.0409,-0.1485,-0.4748,0.0973,4.2405,-15.6978,-0.0398,0.4214,-0.5758,0.1652],[27.7828,0.2367,-0.0027,0.0432,-0.1635,-0.4017,0.07,4.258,-15.4754,-0.035,0.3149,-0.4222,0.1074],[33.321,0.2081,-0.0028,0.0559,-0.2079,-0.5491,0.2782,3.9722,-17.4641,-0.0453,0.3091,-0.4165,0.114],[34.8309,0.2081,-0.003,0.0647,-0.2508,-0.6942,0.426,3.3318,-16.8497,-0.0416,0.1445,-0.1779,0.0236],[37.5926,0.1823,-0.0015,0.0474,-0.1947,-0.6443,0.3677,3.4067,-16.42,-0.0411,0.2234,-0.2936,0.0668],[39.4412,0.1635,-0.0003,0.0348,-0.1585,-0.5625,0.2263,4.2984,-18.3087,-0.0452,0.3142,-0.4246,0.1158],[40.6765,0.1599,-0.0002,0.0372,-0.1782,-0.6234,0.3141,3.8208,-17.9457,-0.041,0.1452,-0.1684,-0.0017],[38.5263,0.1784,-0.0007,0.0354,-0.1608,-0.6294,0.3817,3.0897,-16.2418,-0.0439,0.2718,-0.3597,0.0853],[38.8799,0.186,-0.0008,0.037,-0.1615,-0.7551,0.4856,2.734,-15.7989,-0.0449,0.292,-0.3993,0.1186],[41.2743,0.1795,-0.0009,0.042,-0.1746,-0.9011,0.6699,2.2512,-16.8137,-0.0484,0.2216,-0.293,0.0726],[42.2558,0.1817,-0.0009,0.0441,-0.1858,-1.0062,0.7158,2.6789,-19.1943,-0.0468,0.0978,-0.112,0.002],[40.2612,0.1974,-0.0012,0.0445,-0.1857,-0.9872,0.7444,1.7973,-16.1566,-0.0476,0.1203,-0.1402,0.0055],[43.6457,0.1751,-0.0005,0.0411,-0.1774,-1.0069,0.734,1.9082,-15.776,-0.054,0.2098,-0.2758,0.0684],[37.4261,0.2262,-0.0023,0.0517,-0.2087,-1.0061,0.8119,0.7582,-12.6239,-0.0439,0.0866,-0.0919,-0.0122],[39.6219,0.228,-0.0027,0.0582,-0.2341,-1.2657,1.1924,-1.7105,-7.6258,-0.047,-0.0208,0.0811,-0.1069],[40.843,0.2204,-0.0032,0.0673,-0.2749,-1.2324,1.2238,-1.9885,-7.0689,-0.0429,-0.1374,0.2503,-0.1721],[43.5592,0.2012,-0.0024,0.0607,-0.2564,-1.2444,1.2281,-1.7233,-8.2869,-0.0432,-0.1732,0.3033,-0.1943],[44.6015,0.197,-0.0025,0.062,-0.2557,-1.2557,1.2143,-1.1069,-11.0077,-0.0368,-0.2817,0.4521,-0.2374],[43.431,0.2221,-0.0031,0.0664,-0.2718,-1.4836,1.4844,-2.8301,-7.691,-0.0343,-0.3518,0.5529,-0.2744],[40.2503,0.2524,-0.0038,0.0674,-0.2644,-1.5293,1.5113,-3.3498,-5.9574,-0.0307,-0.3766,0.5899,-0.2912],[38.7912,0.2581,-0.0037,0.0597,-0.2243,-1.4248,1.4482,-3.6476,-4.2826,-0.033,-0.308,0.4967,-0.266],[43.1602,0.2217,-0.0018,0.0357,-0.1265,-1.3762,1.3057,-2.4967,-6.1669,-0.0409,-0.031,0.0745,-0.0711],[44.7535,0.2031,-0.0006,0.0171,-0.0429,-1.2714,1.1636,-1.6742,-7.0124,-0.0436,0.1573,-0.2169,0.0706],[44.9528,0.1953,-0.0005,0.0153,-0.0298,-1.1354,1.0103,-0.6896,-9.5126,-0.0404,0.1044,-0.1372,0.0343],[39.8113,0.2237,-0.002,0.0227,-0.0406,-0.9011,0.8911,-1.1437,-6.6547,-0.0358,0.093,-0.1099,0.0051],[37.8989,0.2482,-0.0029,0.031,-0.0735,-1.0051,1.0055,-1.5428,-6.9588,-0.0328,-0.0609,0.1319,-0.119],[35.1924,0.2601,-0.0037,0.0368,-0.0925,-0.8104,0.8253,-0.5962,-9.35,-0.0269,-0.1549,0.2764,-0.1888],[35.6873,0.254,-0.0041,0.0431,-0.1168,-0.7372,0.8448,-1.3541,-6.8503,-0.023,-0.2589,0.4332,-0.2593],[32.6133,0.2691,-0.0053,0.0532,-0.1439,-0.5491,0.7277,-1.3961,-5.5317,-0.0153,-0.3595,0.5813,-0.3205],[34.8437,0.2492,-0.0052,0.0579,-0.1655,-0.4711,0.6905,-1.4542,-4.7991,-0.0189,-0.3396,0.557,-0.3175],[35.5381,0.2433,-0.0053,0.063,-0.1896,-0.4317,0.6593,-1.2682,-5.2622,-0.0217,-0.3173,0.5302,-0.316],[36.1777,0.2409,-0.0052,0.0631,-0.1933,-0.4466,0.641,-0.9947,-5.8087,-0.022,-0.1927,0.3323,-0.2121],[41.2921,0.2021,-0.0034,0.0497,-0.1573,-0.4612,0.5856,-0.5033,-6.0372,-0.0331,0.0525,-0.035,-0.0513],[43.0646,0.1798,-0.0016,0.0281,-0.0904,-0.3308,0.3256,1.3124,-9.9318,-0.0459,0.3232,-0.4202,0.0842],[44.3551,0.1628,-0.0011,0.0241,-0.0832,-0.1948,0.1835,1.9859,-10.8501,-0.0524,0.5032,-0.684,0.19],[41.152,0.1771,-0.0019,0.0273,-0.0838,0.0212,-0.0243,2.9817,-12.3905,-0.047,0.5514,-0.7673,0.2434],[40.7747,0.1742,-0.0025,0.0343,-0.0976,0.1804,-0.1901,4.1333,-15.4608,-0.0441,0.5815,-0.8266,0.2933],[42.6723,0.1599,-0.0024,0.0353,-0.0956,0.2057,-0.2093,4.492,-16.8094,-0.0449,0.6759,-0.9819,0.3834],[44.4726,0.1485,-0.0024,0.0365,-0.0871,0.1842,-0.1287,4.2111,-17.151,-0.036,0.5025,-0.7363,0.2978],[44.4307,0.1602,-0.0031,0.0461,-0.1195,0.0412,0.0455,3.5578,-17.0706,-0.0272,0.2636,-0.3881,0.1611],[46.146,0.1634,-0.0032,0.0504,-0.1357,-0.1944,0.3303,2.0667,-14.4506,-0.0212,0.0591,-0.0927,0.0497],[48.5522,0.1537,-0.0035,0.0626,-0.1955,-0.2845,0.4266,2.1896,-16.3502,-0.0152,-0.2111,0.308,-0.1179],[47.5272,0.1683,-0.0032,0.0566,-0.179,-0.3843,0.5027,1.5489,-14.8051,-0.0162,-0.1752,0.2648,-0.1172],[42.3688,0.2003,-0.0031,0.0394,-0.1,-0.2544,0.359,1.5821,-13.3586,-0.023,0.1762,-0.2505,0.0889],[40.419,0.2085,-0.0028,0.0242,-0.027,-0.1244,0.2024,2.2651,-13.8723,-0.0263,0.4803,-0.717,0.3102],[41.2786,0.2234,-0.0037,0.0333,-0.0397,-0.4001,0.5512,0.3246,-9.9661,-0.0258,0.411,-0.6274,0.2957],[44.5475,0.202,-0.0036,0.0417,-0.0815,-0.4095,0.5884,0.3313,-11.0779,-0.024,0.2501,-0.3889,0.1968],[48.1433,0.1854,-0.0038,0.0599,-0.1887,-0.5054,0.6845,0.6598,-14.3615,-0.0266,0.0236,-0.0355,0.0216],[36.6027,0.2648,-0.0058,0.0611,-0.1823,-0.2846,0.4948,0.5126,-11.9027,-0.0318,0.3126,-0.4516,0.177],[32.668,0.2977,-0.0064,0.0584,-0.1674,-0.2953,0.5385,-0.5236,-7.6933,-0.0333,0.4917,-0.7205,0.2953],[34.2675,0.2927,-0.0065,0.0568,-0.1384,-0.3725,0.6712,-1.4456,-4.71,-0.0262,0.4807,-0.7367,0.354],[34.5736,0.3039,-0.0074,0.0666,-0.1528,-0.5184,0.8798,-2.5558,-3.2479,-0.013,0.1827,-0.311,0.2009],[38.2705,0.2993,-0.0068,0.0702,-0.2122,-0.8498,1.178,-3.1281,-5.8888,-0.0147,-0.202,0.2993,-0.1195],[27.2619,0.3797,-0.0092,0.0796,-0.2446,-0.709,1.1524,-4.729,0.3025,-0.0222,0.1254,-0.163,0.0363],[30.6429,0.3476,-0.0081,0.0684,-0.2186,-0.6031,1.1239,-5.8827,7.3287,-0.027,0.4252,-0.6274,0.2628],[38.2584,0.2884,-0.0057,0.0424,-0.1141,-0.5815,1.057,-5.5212,7.7327,-0.0255,0.4732,-0.7143,0.3218],[34.2063,0.33,-0.0072,0.0412,-0.0552,-0.6992,1.3687,-7.5293,9.9367,-0.0037,0.0265,-0.062,0.0645],[28.3761,0.3702,-0.009,0.0557,-0.0992,-0.5032,1.1656,-6.5035,7.3478,0.0012,-0.2162,0.3295,-0.1511],[31.5473,0.333,-0.0093,0.0772,-0.2338,-0.191,0.8482,-4.995,5.5448,-0.0012,-0.3665,0.5893,-0.3214],[28.0599,0.3597,-0.0102,0.0796,-0.2161,-0.1241,0.7701,-4.7329,5.1931,-0.0098,0.0298,-0.0073,-0.0557],[23.6587,0.3693,-0.0097,0.0627,-0.1368,0.3036,0.2722,-3.1305,5.7577,-0.0164,0.4595,-0.6438,0.21],[30.6936,0.3406,-0.0098,0.0776,-0.195,0.0131,0.6061,-3.5047,1.8377,-0.0166,0.1956,-0.2534,0.0492],[36.2121,0.3083,-0.0089,0.0774,-0.1975,-0.1094,0.7833,-3.9736,0.5351,-0.0148,0.091,-0.0977,-0.0189],[42.9427,0.2634,-0.0082,0.0706,-0.1836,-0.2087,1.2659,-7.7504,8.427,0.0138,-0.4419,0.6751,-0.3217],[35.6163,0.3365,-0.0098,0.0787,-0.2043,-0.3308,1.3791,-8.3941,8.0466,-0.0005,-0.1455,0.2492,-0.1613],[52.6206,0.1778,-0.0082,0.0886,-0.2524,0.342,0.8903,-5.8391,3.6866,0.0117,-0.5949,0.9156,-0.4441],[73.797,0.0592,-0.0043,0.0809,-0.2789,-0.1315,1.1805,-3.1333,-12.7158,-0.052,0.1674,-0.2079,0.0315],[106.9205,-0.131,0.0011,0.064,-0.2761,-0.8638,1.9387,-5.949,-7.0235,-0.1211,0.5938,-0.7577,0.1352]];

// Knots for restricted cubic splines
const KNOTS = {
    M: {
        height: [107.8, 140.0, 154.5, 166.4, 179.1],
        age: [5.06, 10.79, 13.22, 14.51, 17.30],
        interaction: [-15, 8.9, 50.375, 112.684, 250.04]
    },
    F: {
        height: [106.7, 140.7, 154.0, 160.5, 168.9],
        age: [5.00, 10.70, 13.16, 14.51, 17.33],
        interaction: [6.701, 16.438, 46.80, 84.46, 203.608]
    }
};

// Valid height ranges by age (approximate, for warning purposes)
const HEIGHT_RANGES = {
    M: { min: 70, max: 200 },  // Males
    F: { min: 65, max: 190 }   // Females
};

// =============================================================================
// HEIGHT Z-SCORE CALCULATION (CDC LMS method)
// =============================================================================
function calculateHeightZScore(heightCm, ageYears, sex) {
    const ageMonths = Math.round(ageYears * 12);
    const lmsData = CDC_HEIGHT_LMS[sex];
    
    // Find closest age in LMS table
    const ages = Object.keys(lmsData).map(Number).sort((a, b) => a - b);
    let closestAge = ages[0];
    let minDiff = Math.abs(ageMonths - closestAge);
    
    for (const age of ages) {
        const diff = Math.abs(ageMonths - age);
        if (diff < minDiff) {
            minDiff = diff;
            closestAge = age;
        }
    }
    
    const [L, M, S] = lmsData[closestAge];
    
    // LMS Z-score formula
    if (L === 0) {
        return Math.log(heightCm / M) / S;
    } else {
        return (Math.pow(heightCm / M, L) - 1) / (L * S);
    }
}

// =============================================================================
// SPLINE CALCULATIONS
// =============================================================================
function calculateSplineBasis(value, knots) {
    const [t1, t2, t3, t4, t5] = knots;
    const x2a = Math.max(0, value - t1);
    const x2b = Math.max(0, value - t4);
    const x2c = Math.max(0, value - t5);
    const x2 = Math.pow(x2a, 3) - Math.pow(x2b, 3) * (t5 - t1) / (t5 - t4) + Math.pow(x2c, 3) * (t4 - t1) / (t5 - t4);
    const x3a = Math.max(0, value - t2);
    const x3 = Math.pow(x3a, 3) - Math.pow(x2b, 3) * (t5 - t2) / (t5 - t4) + Math.pow(x2c, 3) * (t4 - t2) / (t5 - t4);
    const x4a = Math.max(0, value - t3);
    const x4 = Math.pow(x4a, 3) - Math.pow(x2b, 3) * (t5 - t3) / (t5 - t4) + Math.pow(x2c, 3) * (t4 - t3) / (t5 - t4);
    return { s2: x2, s3: x3, s4: x4 };
}

function getBPAtPercentile(coefficients, percentileIndex, age, height, sex) {
    const knots = KNOTS[sex];
    const coef = coefficients[percentileIndex];
    
    const x = height;
    const xSpline = calculateSplineBasis(height, knots.height);
    const x2s = xSpline.s2 / 100;
    const x3s = xSpline.s3 / 100;
    const x4s = xSpline.s4 / 100;
    
    const y = age;
    const ySpline = calculateSplineBasis(age, knots.age);
    const y2s = ySpline.s2 / 100;
    const y3s = ySpline.s3 / 100;
    const y4s = ySpline.s4 / 100;
    
    const w = (age - 10) * (height - 150);
    const wSpline = calculateSplineBasis(w, knots.interaction);
    const w2s = wSpline.s2 / 10000;
    const w3s = wSpline.s3 / 10000;
    const w4s = wSpline.s4 / 10000;
    
    return coef[0] 
        + coef[1] * x + coef[2] * x2s + coef[3] * x3s + coef[4] * x4s
        + coef[5] * y + coef[6] * y2s + coef[7] * y3s + coef[8] * y4s
        + coef[9] * w + coef[10] * w2s + coef[11] * w3s + coef[12] * w4s;
}

function findPercentile(coefficients, bp, age, height, sex) {
    let closestPct = 1;
    let minDiff = Infinity;
    
    for (let pct = 0; pct < 99; pct++) {
        const bpAtPct = getBPAtPercentile(coefficients, pct, age, height, sex);
        const diff = Math.abs(bp - bpAtPct);
        if (diff < minDiff) {
            minDiff = diff;
            closestPct = pct + 1;
        }
    }
    return closestPct;
}

// =============================================================================
// CLASSIFICATION (AAP 2017)
// =============================================================================
function classify(age, sbp, dbp, sbpPct, dbpPct, sbp95, dbp95) {
    if (age >= 13) {
        if (sbp >= 140 || dbp >= 90) return { class: 'Stage 2 HTN', css: 'stage2' };
        if (sbp >= 130 || dbp >= 80) return { class: 'Stage 1 HTN', css: 'stage1' };
        if (sbp >= 120) return { class: 'Elevated BP', css: 'elevated' };
        return { class: 'Normal', css: 'normal' };
    } else {
        const sbp95p12 = sbp95 + 12;
        const dbp95p12 = dbp95 + 12;
        
        if (sbp >= sbp95p12 || dbp >= dbp95p12 || sbp >= 140 || dbp >= 90) {
            return { class: 'Stage 2 HTN', css: 'stage2' };
        }
        if (sbpPct >= 95 || dbpPct >= 95 || sbp >= 130 || dbp >= 80) {
            return { class: 'Stage 1 HTN', css: 'stage1' };
        }
        if (sbpPct >= 90 || dbpPct >= 90 || sbp >= 120) {
            return { class: 'Elevated BP', css: 'elevated' };
        }
        return { class: 'Normal', css: 'normal' };
    }
}

// =============================================================================
// UI HELPERS
// =============================================================================

// Calculate age from DOB (optionally relative to a reference date)
function calculateAgeFromDOB(dob, referenceDate) {
    const refDate = referenceDate ? new Date(referenceDate) : new Date();
    const birthDate = new Date(dob);
    let years = refDate.getFullYear() - birthDate.getFullYear();
    let months = refDate.getMonth() - birthDate.getMonth();
    if (months < 0 || (months === 0 && refDate.getDate() < birthDate.getDate())) {
        years--;
        months += 12;
    }
    if (refDate.getDate() < birthDate.getDate()) {
        months--;
        if (months < 0) months += 12;
    }
    return { years, months, decimal: years + months / 12 };
}

// Get measurement date (defaults to today)
function getMeasureDate() {
    return document.getElementById('measureDate').value || new Date().toISOString().split('T')[0];
}

// Update age display based on DOB and measurement date
function updateAgeDisplay() {
    const ageDisplay = document.getElementById('ageDisplay');
    const dobValue = document.getElementById('dob').value;
    if (!dobValue) {
        ageDisplay.textContent = '';
        return;
    }
    const age = calculateAgeFromDOB(dobValue, getMeasureDate());
    if (age.decimal < 1 || age.decimal > 18) {
        ageDisplay.textContent = `${age.years}y ${age.months}m ‚Äî outside valid range (1-17 years)`;
        ageDisplay.style.color = '#dc2626';
    } else {
        ageDisplay.textContent = `Age at measurement: ${age.years} years, ${age.months} months`;
        ageDisplay.style.color = '#2563eb';
    }
    updateHeightZscore();
}

// DOB and measurement date handlers
document.getElementById('dob').addEventListener('change', updateAgeDisplay);
document.getElementById('measureDate').addEventListener('change', updateAgeDisplay);

// Set today's date as default measurement date on load
document.getElementById('measureDate').value = new Date().toISOString().split('T')[0];

// Sex toggle handler
document.querySelectorAll('.sex-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.sex-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        document.getElementById('sex').value = this.dataset.value;
        updateHeightZscore();
    });
});

// Real-time height z-score display
document.getElementById('height').addEventListener('input', updateHeightZscore);
document.getElementById('heightUnit').addEventListener('change', updateHeightZscore);
document.getElementById('dob').addEventListener('change', updateHeightZscore);
document.getElementById('sex').addEventListener('change', updateHeightZscore);

function updateHeightZscore() {
    const zscoreEl = document.getElementById('heightZscore');
    const sex = document.getElementById('sex').value;
    let height = parseFloat(document.getElementById('height').value);
    const heightUnit = document.getElementById('heightUnit').value;
    
    // Get age from DOB
    const dobValue = document.getElementById('dob').value;
    if (!dobValue) {
        zscoreEl.textContent = '';
        return;
    }
    const ageData = calculateAgeFromDOB(dobValue, getMeasureDate());
    const age = ageData.decimal;

    if (isNaN(height) || height <= 0 || age < 1) {
        zscoreEl.textContent = '';
        return;
    }

    if (heightUnit === 'in') {
        height = height * 2.54;
    }
    
    const zscore = calculateHeightZScore(height, age, sex);
    const zscoreText = zscore.toFixed(2);
    let warning = '';
    
    if (Math.abs(zscore) > 3.09) {
        warning = ' ‚ö†Ô∏è OUTLIER - outside ¬±3.09 SD';
        zscoreEl.style.color = '#dc2626';
    } else if (Math.abs(zscore) > 2) {
        warning = ' ‚ö†Ô∏è Unusual height for age';
        zscoreEl.style.color = '#d97706';
    } else {
        zscoreEl.style.color = '#64748b';
    }
    
    zscoreEl.textContent = `Height Z-score: ${zscoreText}${warning}`;
}

// =============================================================================
// MAIN CALCULATION
// =============================================================================
function calculate() {
    const errorEl = document.getElementById('error');
    const warningsEl = document.getElementById('warnings');
    const resultsEl = document.getElementById('results');
    errorEl.textContent = '';
    warningsEl.innerHTML = '';
    resultsEl.classList.remove('show');
    
    const sex = document.getElementById('sex').value;
    let height = parseFloat(document.getElementById('height').value);
    const heightUnit = document.getElementById('heightUnit').value;
    const sbp = parseFloat(document.getElementById('sbp').value);
    const dbp = parseFloat(document.getElementById('dbp').value);
    
    // Parse age from DOB relative to measurement date
    const dobValue = document.getElementById('dob').value;
    if (!dobValue) {
        errorEl.textContent = 'Please enter date of birth.';
        return;
    }
    const ageData = calculateAgeFromDOB(dobValue, getMeasureDate());
    const age = ageData.decimal;

    // =========================================================================
    // ROSNER AGE ADJUSTMENT
    // DOB gives us exact age in Y+M format, so use +0.5 months adjustment
    // =========================================================================
    const adjustedAge = age + 0.5/12;
    const ageAdjustment = '+0.5mo';
    
    // Validation
    if (isNaN(age) || age < 1 || age > 17.99) {
        errorEl.textContent = 'Please enter age between 1 and 17 years.';
        return;
    }
    if (isNaN(height) || height <= 0) {
        errorEl.textContent = 'Please enter a valid height.';
        return;
    }
    if (isNaN(sbp) || isNaN(dbp)) {
        errorEl.textContent = 'Please enter valid blood pressure values.';
        return;
    }
    
    // Convert height to cm if needed
    if (heightUnit === 'in') {
        height = height * 2.54;
    }
    
    // =========================================================================
    // HEIGHT Z-SCORE VALIDATION
    // =========================================================================
    const heightZscore = calculateHeightZScore(height, age, sex);
    const warnings = [];
    
    if (Math.abs(heightZscore) > 3.09) {
        warnings.push({
            type: 'error',
            text: `‚ö†Ô∏è HEIGHT OUTLIER: Z-score ${heightZscore.toFixed(2)} is outside ¬±3.09 SD. Results may be unreliable due to extrapolation beyond validated range.`
        });
    } else if (Math.abs(heightZscore) > 2.5) {
        warnings.push({
            type: 'warning',
            text: `‚ö†Ô∏è Unusual height for age (Z-score: ${heightZscore.toFixed(2)}). Verify measurement accuracy.`
        });
    }
    
    // Age boundary warnings
    if (adjustedAge < 5.06 && sex === 'M') {
        warnings.push({
            type: 'warning',
            text: '‚ö†Ô∏è Age below minimum knot (5.06 years for males). Spline extrapolation may reduce accuracy.'
        });
    }
    if (adjustedAge < 5.00 && sex === 'F') {
        warnings.push({
            type: 'warning',
            text: '‚ö†Ô∏è Age below minimum knot (5.00 years for females). Spline extrapolation may reduce accuracy.'
        });
    }
    if (adjustedAge > 17.30 && sex === 'M') {
        warnings.push({
            type: 'warning',
            text: '‚ö†Ô∏è Age above maximum knot (17.30 years for males). Spline extrapolation may reduce accuracy.'
        });
    }
    if (adjustedAge > 17.33 && sex === 'F') {
        warnings.push({
            type: 'warning',
            text: '‚ö†Ô∏è Age above maximum knot (17.33 years for females). Spline extrapolation may reduce accuracy.'
        });
    }
    
    // Display warnings
    if (warnings.length > 0) {
        warningsEl.innerHTML = warnings.map(w => 
            `<div class="warning">${w.text}</div>`
        ).join('');
    }
    
    // =========================================================================
    // CALCULATE PERCENTILES
    // =========================================================================
    const sbpCoef = sex === 'M' ? SBP_M : SBP_F;
    const dbpCoef = sex === 'M' ? DBP_M : DBP_F;
    
    const sbpPct = findPercentile(sbpCoef, sbp, adjustedAge, height, sex);
    const dbpPct = findPercentile(dbpCoef, dbp, adjustedAge, height, sex);
    
    // Get threshold values
    const sbp90 = getBPAtPercentile(sbpCoef, 89, adjustedAge, height, sex);
    const dbp90 = getBPAtPercentile(dbpCoef, 89, adjustedAge, height, sex);
    const sbp95 = getBPAtPercentile(sbpCoef, 94, adjustedAge, height, sex);
    const dbp95 = getBPAtPercentile(dbpCoef, 94, adjustedAge, height, sex);
    
    // Classification
    const result = classify(adjustedAge, sbp, dbp, sbpPct, dbpPct, sbp95, dbp95);
    
    // =========================================================================
    // DISPLAY RESULTS
    // =========================================================================
    document.getElementById('sbpPct').textContent = sbpPct + 'th %ile';
    document.getElementById('sbpDetail').textContent = sbp + ' mmHg';
    document.getElementById('dbpPct').textContent = dbpPct + 'th %ile';
    document.getElementById('dbpDetail').textContent = dbp + ' mmHg';
    
    const classEl = document.getElementById('classification');
    classEl.textContent = result.class;
    classEl.className = 'classification ' + result.css;

    // Update visual gauges (map percentile 1-99 to 0-100% bar position)
    // Bar zones: 0-80% = <90th (green), 80-90% = 90-95th (yellow), 90-95% = 95-99th (orange), 95-100% = >99th (red)
    function pctToGaugePos(pct) {
        if (pct <= 50) return (pct / 50) * 40;  // 1-50 maps to 0-40%
        if (pct <= 90) return 40 + ((pct - 50) / 40) * 40;  // 50-90 maps to 40-80%
        if (pct <= 95) return 80 + ((pct - 90) / 5) * 10;  // 90-95 maps to 80-90%
        return 90 + ((pct - 95) / 5) * 10;  // 95-100 maps to 90-100%
    }
    document.getElementById('sbpMarker').style.left = pctToGaugePos(sbpPct) + '%';
    document.getElementById('dbpMarker').style.left = pctToGaugePos(dbpPct) + '%';

    document.getElementById('p90').textContent = Math.round(sbp90) + '/' + Math.round(dbp90) + ' mmHg';
    document.getElementById('p95').textContent = Math.round(sbp95) + '/' + Math.round(dbp95) + ' mmHg';
    document.getElementById('p95plus12').textContent = Math.round(sbp95 + 12) + '/' + Math.round(dbp95 + 12) + ' mmHg';
    
    // Calculation details
    const detailsEl = document.getElementById('calcDetails');
    detailsEl.innerHTML = `
        Age: ${adjustedAge.toFixed(2)} yrs${ageAdjustment !== 'no adjustment' ? ' (' + ageAdjustment + ')' : ''} &bull; 
        Height: ${height.toFixed(1)} cm (Z: ${heightZscore.toFixed(2)})
    `;
    
    resultsEl.classList.add('show');
}
    </script>
</body>
</html>
